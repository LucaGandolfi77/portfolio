<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title data-i18n="page.title">Books — Luca Gandolfi</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root{--paper-bg:#f5ead0;--accent:#8b5e34;--muted:#7b5a3c;--glass:rgba(255,255,255,0.6)}
        html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:var(--paper-bg);color:#2b2b2b}
        /* subtle paper texture using SVG data URI */
        body::before{
            content:'';position:fixed;inset:0;z-index:0;pointer-events:none;background-image:linear-gradient(rgba(0,0,0,0.02) 1px, transparent 1px), radial-gradient(rgba(0,0,0,0.02) 0.6px, transparent 0.6px);
            background-size:100% 24px, 6px 6px;opacity:0.6;
        }
        .wrap{position:relative;z-index:1;max-width:1000px;margin:36px auto;padding:28px;background:linear-gradient(180deg,rgba(255,255,255,0.6),rgba(255,255,255,0.55));border-radius:12px;box-shadow:0 10px 30px rgba(16,16,16,0.08)}
        a.back{display:inline-flex;align-items:center;gap:8px;color:var(--accent);text-decoration:none;margin-bottom:12px;font-weight:600}
        h1{margin:6px 0 10px;font-size:2rem;color:var(--accent)}
        p.lead{margin-bottom:18px;color:var(--muted)}

        /* Accordion */
        .accordion{display:grid;gap:12px}
        .acc-item{border-radius:10px;overflow:hidden;border:1px solid rgba(0,0,0,0.06);background:rgba(255,255,255,0.85)}
        .acc-header{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:14px 16px;cursor:pointer}
        .acc-header button{all:unset;display:flex;align-items:center;gap:12px;width:100%;cursor:pointer}
        .acc-title{font-weight:700;color:#3a2b22}
        .acc-preview{color:#6b5b4a;font-size:0.95rem}
        .caret{transition:transform 0.25s ease;color:#7a5a3b}
        .acc-content{padding:0 16px;max-height:0;overflow:hidden;transition:max-height 0.35s ease;padding-bottom:0}
        .acc-content.open{padding:12px 16px 18px}
        .book-list{display:grid;gap:8px}
        .book-item{padding:8px;border-radius:8px;background:rgba(0,0,0,0.02);border:1px solid rgba(0,0,0,0.03)}

        /* small screens */
        @media (max-width:640px){.wrap{margin:18px;padding:18px}.acc-header{padding:12px}.acc-content.open{padding:10px 12px 14px}}
    </style>
</head>
<body>
    <div class="wrap" role="main">
        <a class="back" href="index.html">← <span data-i18n="page.back">Back to portfolio</span></a>
        <h1 data-i18n="page.heading">Books</h1>
        <p class="lead" data-i18n="page.lead">Here are a few books I recommend — short notes and links.</p>

        <div class="accordion" id="accordion">
            <!-- items populated by JS -->
        </div>

        <footer style="margin-top:20px;color:#6b5a4a;font-size:0.9rem">© 2025 Luca Gandolfi</footer>
    </div>

    <script>
        // Load translations from external JSON at /i18n/<lang>.json; fallback uses English if unavailable
        async function loadTranslations(lang) {
            try {
                const res = await fetch('/i18n/' + lang + '.json');
                if (!res.ok) throw new Error('non-ok');
                return await res.json();
            } catch (err) {
                console.warn('Failed to load external translations for', lang, err);
                // fallback to english bundle that should exist
                try {
                    const res2 = await fetch('/i18n/en.json');
                    if (res2.ok) return await res2.json();
                } catch (e) {}
                return {};
            }
        }

        // detect language preference from localStorage (same key used in index.html)
        const savedLang = localStorage.getItem('lang') || 'en';

        function getNested(obj, path){
            return path.split('.').reduce((o,k)=> (o && o[k]!==undefined)? o[k]: undefined, obj);
        }

        function buildAccordion(t){
            const acc = document.getElementById('accordion');
            acc.innerHTML = '';
            const sections = (t && t.books && t.books.sections) ? t.books.sections : {};
            for(const key of ['read','recommended','quotes','life']){
                const s = sections[key] || { title: key, preview: '', items: [] };
                const item = document.createElement('div');
                item.className = 'acc-item';
                item.innerHTML = `
                    <div class="acc-header">
                        <button aria-expanded="false" class="acc-btn">
                            <div style="display:flex;flex-direction:column;align-items:flex-start">
                                <div class="acc-title">${s.title}</div>
                                <div class="acc-preview">${s.preview}</div>
                            </div>
                            <div class="caret">▸</div>
                        </button>
                    </div>
                    <div class="acc-content" aria-hidden="true">
                        <div class="book-list">
                            ${s.items.map(i=>`<div class="book-item">${i}</div>`).join('')}
                        </div>
                    </div>
                `;
                // wire toggle
                const btn = item.querySelector('.acc-btn');
                const content = item.querySelector('.acc-content');
                const caret = item.querySelector('.caret');
                btn.addEventListener('click', ()=> toggle(item, btn, content, caret));
                btn.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' ') { e.preventDefault(); toggle(item, btn, content, caret); } });
                acc.appendChild(item);
            }
        }

        function toggle(item, btn, content, caret){
            const isOpen = btn.getAttribute('aria-expanded') === 'true';
            if(isOpen){
                btn.setAttribute('aria-expanded','false');
                content.style.maxHeight = '0';
                content.setAttribute('aria-hidden','true');
                content.classList.remove('open');
                caret.style.transform = '';
            } else {
                // close any other open
                document.querySelectorAll('.acc-item .acc-btn[aria-expanded="true"]').forEach(otherBtn=>{
                    otherBtn.setAttribute('aria-expanded','false');
                    const otherContent = otherBtn.closest('.acc-item').querySelector('.acc-content');
                    otherContent.style.maxHeight = '0';
                    otherContent.setAttribute('aria-hidden','true');
                    otherContent.classList.remove('open');
                    otherBtn.closest('.acc-item').querySelector('.caret').style.transform = '';
                });

                btn.setAttribute('aria-expanded','true');
                content.classList.add('open');
                content.style.maxHeight = content.scrollHeight + 'px';
                content.setAttribute('aria-hidden','false');
                caret.style.transform = 'rotate(90deg)';
            }
        }

        // apply page-level translations using loaded translation object `t`
        function applyPageTranslations(t){
            if(!t) return;
            document.querySelectorAll('[data-i18n]').forEach(el=>{
                const key = el.getAttribute('data-i18n');
                // prefer direct path, else try under books.* (books page translations are nested)
                let val = getNested(t, key);
                if (val === undefined) val = getNested(t, 'books.' + key);
                if (val !== undefined) el.textContent = val;
            });
            document.title = getNested(t, 'books.page.title') || document.title;
        }

        document.addEventListener('DOMContentLoaded', async ()=>{
            const t = await loadTranslations(savedLang);
            applyPageTranslations(t);
            buildAccordion(t);
        });
    </script>
</body>
</html>
